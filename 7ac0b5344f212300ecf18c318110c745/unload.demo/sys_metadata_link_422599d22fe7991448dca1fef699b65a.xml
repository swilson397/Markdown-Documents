<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_metadata_link">
    <sys_metadata_link action="INSERT_OR_UPDATE">
        <directory>unload.demo</directory>
        <documentkey>0e53a61cdb317300d0cb5385ca9619bc</documentkey>
        <payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="x_58056_md_docs_markdown_source">
    <x_58056_md_docs_markdown_source action="INSERT_OR_UPDATE">
        <abstract_syntax_tree>{"type":"Program","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"domainID"},"init":{"type":"Literal","value":"ff7002960a0a3c810059c36fce436914","raw":"\"ff7002960a0a3c810059c36fce436914\""}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"noUpdate"},"init":{"type":"Literal","value":true,"raw":"true"}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"maxUsers"},"init":{"type":"Literal","value":1000,"raw":"1000"}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"usersWithUpdates"},"init":{"type":"Literal","value":0,"raw":"0"}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"maxUserUpdates"},"init":{"type":"Literal","value":1,"raw":"1"}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tablesAndColumns"},"init":{"type":"ArrayExpression","elements":[{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Task","raw":"\"Task\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"task","raw":"\"task\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"assigned_to","raw":"\"assigned_to\""},{"type":"Literal","value":"opened_by","raw":"\"opened_by\""},{"type":"Literal","value":"closed_by","raw":"\"closed_by\""},{"type":"Literal","value":"u_resolved_by","raw":"\"u_resolved_by\""},{"type":"Literal","value":"watch_list","raw":"\"watch_list\""},{"type":"Literal","value":"u_group_watch_list","raw":"\"u_group_watch_list\""},{"type":"Literal","value":"additional_assignee_list","raw":"\"additional_assignee_list\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Incident","raw":"\"Incident\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"incident","raw":"\"incident\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"caller_id","raw":"\"caller_id\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Change Request","raw":"\"Change Request\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"change_request","raw":"\"change_request\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"requested_by","raw":"\"requested_by\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Facilities Request","raw":"\"Facilities Request\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"facilities","raw":"\"facilities\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"caller_id","raw":"\"caller_id\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"KB Submission","raw":"\"KB Submission\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"kb_submission","raw":"\"kb_submission\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"submitted_by","raw":"\"submitted_by\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Project","raw":"\"Project\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"pm_project","raw":"\"pm_project\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"project_manager","raw":"\"project_manager\""},{"type":"Literal","value":"sponsor","raw":"\"sponsor\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Request","raw":"\"Request\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"sc_request","raw":"\"sc_request\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"requested_for","raw":"\"requested_for\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Asset","raw":"\"Asset\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"alm_asset","raw":"\"alm_asset\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"assigned_to","raw":"\"assigned_to\""},{"type":"Literal","value":"managed_by","raw":"\"managed_by\""},{"type":"Literal","value":"owned_by","raw":"\"owned_by\""},{"type":"Literal","value":"reserved_for","raw":"\"reserved_for\""},{"type":"Literal","value":"supported_by","raw":"\"supported_by\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Configuration Item","raw":"\"Configuration Item\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"cmdb_ci","raw":"\"cmdb_ci\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"assigned_to","raw":"\"assigned_to\""},{"type":"Literal","value":"managed_by","raw":"\"managed_by\""},{"type":"Literal","value":"owned_by","raw":"\"owned_by\""},{"type":"Literal","value":"supported_by","raw":"\"supported_by\""},{"type":"Literal","value":"u_business_manager","raw":"\"u_business_manager\""},{"type":"Literal","value":"u_technical_manager","raw":"\"u_technical_manager\""}]},"kind":"init","method":false,"shorthand":false}]},{"type":"ObjectExpression","properties":[{"type":"Property","key":{"type":"Identifier","name":"label"},"computed":false,"value":{"type":"Literal","value":"Group Membership","raw":"\"Group Membership\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"table"},"computed":false,"value":{"type":"Literal","value":"sys_user_grmember","raw":"\"sys_user_grmember\""},"kind":"init","method":false,"shorthand":false},{"type":"Property","key":{"type":"Identifier","name":"columns"},"computed":false,"value":{"type":"ArrayExpression","elements":[{"type":"Literal","value":"user","raw":"\"user\""}]},"kind":"init","method":false,"shorthand":false}]}]}}],"kind":"var"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"FunctionExpression","id":null,"params":[{"type":"Identifier","name":"domainID"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"CRC Duplicate Users starting @","raw":"\"CRC Duplicate Users starting @\""},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"nowDateTime"}},"arguments":[]}}]}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"goodRecordId"},"init":{"type":"Literal","value":null,"raw":"null"}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"duplicateRecordIds"},"init":{"type":"ArrayExpression","elements":[]}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tableName"},"init":{"type":"Literal","value":null,"raw":"null"}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tableLabel"},"init":{"type":"Literal","value":null,"raw":"null"}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"tableUpdated"},"init":{"type":"Literal","value":false,"raw":"false"}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"userUpdated"},"init":{"type":"Literal","value":false,"raw":"false"}}],"kind":"var"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"CallExpression","callee":{"type":"Identifier","name":"getDuplicateUserNames"},"arguments":[]},"property":{"type":"Identifier","name":"forEach"}},"arguments":[{"type":"Identifier","name":"cleanUpUser"},{"type":"ThisExpression"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"Users with rows to update = ","raw":"\"Users with rows to update = \""},"right":{"type":"Identifier","name":"usersWithUpdates"}}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"CRC Duplicate Users ended @","raw":"\"CRC Duplicate Users ended @\""},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"nowDateTime"}},"arguments":[]}}]}},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"cleanUpUser"},"params":[{"type":"Identifier","name":"userName"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"BinaryExpression","operator":"&gt;=","left":{"type":"Identifier","name":"usersWithUpdates"},"right":{"type":"Identifier","name":"maxUserUpdates"}},"consequent":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":null}]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"duplicateRecordIds"},"right":{"type":"CallExpression","callee":{"type":"Identifier","name":"getUserRecords"},"arguments":[{"type":"Identifier","name":"userName"}]}}},{"type":"IfStatement","test":{"type":"BinaryExpression","operator":"&lt;=","left":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"duplicateRecordIds"},"property":{"type":"Identifier","name":"length"}},"right":{"type":"Literal","value":1,"raw":"1"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"warning"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"No duplicate user records found for user ","raw":"\"No duplicate user records found for user \""},"right":{"type":"Identifier","name":"userName"}}]}},{"type":"ReturnStatement","argument":null}]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"goodRecordId"},"right":{"type":"MemberExpression","computed":true,"object":{"type":"Identifier","name":"duplicateRecordIds"},"property":{"type":"Literal","value":0,"raw":"0"}}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"duplicateRecordIds"},"property":{"type":"Identifier","name":"splice"}},"arguments":[{"type":"Literal","value":0,"raw":"0"},{"type":"Literal","value":1,"raw":"1"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"User ","raw":"\"User \""},"right":{"type":"Identifier","name":"userName"}},"right":{"type":"Literal","value":" dup records = ","raw":"\" dup records = \""}},"right":{"type":"Identifier","name":"duplicateRecordIds"}},"right":{"type":"Literal","value":" good id = ","raw":"\" good id = \""}},"right":{"type":"Identifier","name":"goodRecordId"}}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"userUpdated"},"right":{"type":"Literal","value":false,"raw":"false"}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"tablesAndColumns"},"property":{"type":"Identifier","name":"forEach"}},"arguments":[{"type":"Identifier","name":"updateTable"},{"type":"ThisExpression"}]}},{"type":"IfStatement","test":{"type":"Identifier","name":"userUpdated"},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"UpdateExpression","operator":"++","argument":{"type":"Identifier","name":"usersWithUpdates"},"prefix":false}}]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"userGR"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"GlideRecord"},"arguments":[{"type":"Literal","value":"sys_user","raw":"\"sys_user\""}]}}],"kind":"var"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userGR"},"property":{"type":"Identifier","name":"addQuery"}},"arguments":[{"type":"Literal","value":"sys_domain","raw":"\"sys_domain\""},{"type":"Identifier","name":"domainID"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userGR"},"property":{"type":"Identifier","name":"addQuery"}},"arguments":[{"type":"Literal","value":"sys_id","raw":"\"sys_id\""},{"type":"Identifier","name":"duplicateRecordIds"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userGR"},"property":{"type":"Identifier","name":"query"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userGR"},"property":{"type":"Identifier","name":"active"}},"property":{"type":"Identifier","name":"setValue"}},"arguments":[{"type":"Literal","value":false,"raw":"false"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userGR"},"property":{"type":"Identifier","name":"locked_out"}},"property":{"type":"Identifier","name":"setValue"}},"arguments":[{"type":"Literal","value":true,"raw":"true"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"User ","raw":"\"User \""},"right":{"type":"Identifier","name":"userName"}},"right":{"type":"Literal","value":" query ","raw":"\" query \""}},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userGR"},"property":{"type":"Identifier","name":"getEncodedQuery"}},"arguments":[]}}]}},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","argument":{"type":"Identifier","name":"noUpdate"},"prefix":true},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userGR"},"property":{"type":"Identifier","name":"updateMultiple"}},"arguments":[]}}]},"alternate":null},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"User ","raw":"\"User \""},"right":{"type":"Identifier","name":"userName"}},"right":{"type":"Literal","value":" had ","raw":"\" had \""}},"right":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"duplicateRecordIds"},"property":{"type":"Identifier","name":"length"}}},"right":{"type":"Literal","value":" user records inactivated","raw":"\" user records inactivated\""}}]}}]},"generator":false,"expression":false,"async":false},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"updateTable"},"params":[{"type":"Identifier","name":"tableDetails"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"tableName"},"right":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"tableDetails"},"property":{"type":"Identifier","name":"table"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"tableName"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"tableName"},"property":{"type":"Identifier","name":"trim"}},"arguments":[]}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"tableLabel"},"right":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"tableDetails"},"property":{"type":"Identifier","name":"label"}}}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"tableUpdated"},"right":{"type":"Literal","value":false,"raw":"false"}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"tableDetails"},"property":{"type":"Identifier","name":"columns"}},"property":{"type":"Identifier","name":"forEach"}},"arguments":[{"type":"Identifier","name":"updateTableColumn"},{"type":"ThisExpression"}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"userUpdated"},"right":{"type":"LogicalExpression","operator":"||","left":{"type":"Identifier","name":"userUpdated"},"right":{"type":"Identifier","name":"tableUpdated"}}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"Table ","raw":"\"Table \""},"right":{"type":"Identifier","name":"tableLabel"}},"right":{"type":"Literal","value":" [","raw":"\" [\""}},"right":{"type":"Identifier","name":"tableName"}},"right":{"type":"Literal","value":"] updated = ","raw":"\"] updated = \""}},"right":{"type":"Identifier","name":"tableUpdated"}}]}}]},"generator":false,"expression":false,"async":false},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"updateTableColumn"},"params":[{"type":"Identifier","name":"columnName"}],"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"columnName"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"columnName"},"property":{"type":"Identifier","name":"trim"}},"arguments":[]}}},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"gr"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"GlideRecord"},"arguments":[{"type":"Identifier","name":"tableName"}]}}],"kind":"var"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"initialize"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addQuery"}},"arguments":[{"type":"Literal","value":"sys_domain","raw":"\"sys_domain\""},{"type":"Identifier","name":"domainID"}]}},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","argument":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"isValidField"}},"arguments":[{"type":"Identifier","name":"columnName"}]},"prefix":true},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"warning"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"Invalid column ","raw":"\"Invalid column \""},"right":{"type":"Identifier","name":"columnName"}},"right":{"type":"Literal","value":" for table ","raw":"\" for table \""}},"right":{"type":"Identifier","name":"tableName"}}]}}]},"alternate":null},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"fieldType"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"getElement"}},"arguments":[{"type":"Identifier","name":"columnName"}]},"property":{"type":"Identifier","name":"getED"}},"arguments":[]},"property":{"type":"Identifier","name":"getInternalType"}},"arguments":[]}}],"kind":"var"},{"type":"IfStatement","test":{"type":"BinaryExpression","operator":"==","left":{"type":"Identifier","name":"fieldType"},"right":{"type":"Literal","value":"glide_list","raw":"\"glide_list\""}},"consequent":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"q"},"init":{"type":"Literal","value":null,"raw":"null"}}],"kind":"var"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"duplicateRecordIds"},"property":{"type":"Identifier","name":"forEach"}},"arguments":[{"type":"FunctionExpression","id":null,"params":[{"type":"Identifier","name":"userID"}],"body":{"type":"BlockStatement","body":[{"type":"IfStatement","test":{"type":"Identifier","name":"q"},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"q"},"property":{"type":"Identifier","name":"addOrCondition"}},"arguments":[{"type":"Identifier","name":"columnName"},{"type":"Literal","value":"CONTAINS","raw":"\"CONTAINS\""},{"type":"Identifier","name":"userID"}]}}]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"q"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addQuery"}},"arguments":[{"type":"Identifier","name":"columnName"},{"type":"Literal","value":"CONTAINS","raw":"\"CONTAINS\""},{"type":"Identifier","name":"userID"}]}}}]}}]},"generator":false,"expression":false,"async":false},{"type":"ThisExpression"}]}}]},"alternate":{"type":"IfStatement","test":{"type":"BinaryExpression","operator":"==","left":{"type":"Identifier","name":"fieldType"},"right":{"type":"Literal","value":"reference","raw":"\"reference\""}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addQuery"}},"arguments":[{"type":"Identifier","name":"columnName"},{"type":"Identifier","name":"duplicateRecordIds"}]}}]},"alternate":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"warning"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"Unknown field type ","raw":"\"Unknown field type \""},"right":{"type":"Identifier","name":"fieldType"}},"right":{"type":"Literal","value":" for table ","raw":"\" for table \""}},"right":{"type":"Identifier","name":"tableName"}},"right":{"type":"Literal","value":" column ","raw":"\" column \""}},"right":{"type":"Identifier","name":"columnName"}}]}},{"type":"ReturnStatement","argument":null}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"query"}},"arguments":[]}},{"type":"IfStatement","test":{"type":"BinaryExpression","operator":"&gt;","left":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"getRowCount"}},"arguments":[]},"right":{"type":"Literal","value":0,"raw":"0"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"User sys_ids = ","raw":"\"User sys_ids = \""},"right":{"type":"Identifier","name":"duplicateRecordIds"}},"right":{"type":"Literal","value":" Rows = ","raw":"\" Rows = \""}},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"getRowCount"}},"arguments":[]}},"right":{"type":"Literal","value":" Query = ","raw":"\" Query = \""}},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"getEncodedQuery"}},"arguments":[]}}]}},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"tableUpdated"},"right":{"type":"Literal","value":true,"raw":"true"}}}]},"alternate":null},{"type":"IfStatement","test":{"type":"BinaryExpression","operator":"==","left":{"type":"Identifier","name":"fieldType"},"right":{"type":"Literal","value":"glide_list","raw":"\"glide_list\""}},"consequent":{"type":"BlockStatement","body":[{"type":"WhileStatement","test":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"next"}},"arguments":[]},"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"listValues"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"MemberExpression","computed":true,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"columnName"}},"property":{"type":"Identifier","name":"toString"}},"arguments":[]},"property":{"type":"Identifier","name":"split"}},"arguments":[{"type":"Literal","value":",","raw":"\",\""}]}}],"kind":"var"},{"type":"ExpressionStatement","expression":{"type":"AssignmentExpression","operator":"=","left":{"type":"Identifier","name":"listValues"},"right":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"listValues"},"property":{"type":"Identifier","name":"filter"}},"arguments":[{"type":"FunctionExpression","id":null,"params":[{"type":"Identifier","name":"entry"}],"body":{"type":"BlockStatement","body":[{"type":"ReturnStatement","argument":{"type":"BinaryExpression","operator":"&lt;","left":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"duplicateRecordIds"},"property":{"type":"Identifier","name":"indexOf"}},"arguments":[{"type":"Identifier","name":"entry"}]},"right":{"type":"Literal","value":0,"raw":"0"}}}]},"generator":false,"expression":false,"async":false},{"type":"ThisExpression"}]}}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"listValues"},"property":{"type":"Identifier","name":"push"}},"arguments":[{"type":"Identifier","name":"goodRecordId"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"MemberExpression","computed":true,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"columnName"}},"property":{"type":"Identifier","name":"setValue"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"listValues"},"property":{"type":"Identifier","name":"join"}},"arguments":[{"type":"Literal","value":",","raw":"\",\""}]}]}},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","argument":{"type":"Identifier","name":"noUpdate"},"prefix":true},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"update"}},"arguments":[]}}]},"alternate":null}]}}]},"alternate":{"type":"IfStatement","test":{"type":"BinaryExpression","operator":"==","left":{"type":"Identifier","name":"fieldType"},"right":{"type":"Literal","value":"reference","raw":"\"reference\""}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"MemberExpression","computed":true,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"columnName"}},"property":{"type":"Identifier","name":"setValue"}},"arguments":[{"type":"Identifier","name":"goodRecordId"}]}},{"type":"IfStatement","test":{"type":"UnaryExpression","operator":"!","argument":{"type":"Identifier","name":"noUpdate"},"prefix":true},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"updateMultiple"}},"arguments":[]}}]},"alternate":null}]},"alternate":null}}]},"generator":false,"expression":false,"async":false},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"getUserRecords"},"params":[{"type":"Identifier","name":"userName"}],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"userRecords"},"init":{"type":"ArrayExpression","elements":[]}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"gr"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"GlideRecord"},"arguments":[{"type":"Literal","value":"sys_user","raw":"\"sys_user\""}]}}],"kind":"var"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addQuery"}},"arguments":[{"type":"Literal","value":"sys_domain","raw":"\"sys_domain\""},{"type":"Identifier","name":"domainID"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addQuery"}},"arguments":[{"type":"Literal","value":"user_name","raw":"\"user_name\""},{"type":"Identifier","name":"userName"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addActiveQuery"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"orderBy"}},"arguments":[{"type":"Literal","value":"sys_created_on","raw":"\"sys_created_on\""}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"query"}},"arguments":[]}},{"type":"WhileStatement","test":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"next"}},"arguments":[]},"body":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userRecords"},"property":{"type":"Identifier","name":"push"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"sys_id"}},"property":{"type":"Identifier","name":"toString"}},"arguments":[]}]}}]}},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"userRecords"}}]},"generator":false,"expression":false,"async":false},{"type":"FunctionDeclaration","id":{"type":"Identifier","name":"getDuplicateUserNames"},"params":[],"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"userNames"},"init":{"type":"ArrayExpression","elements":[]}}],"kind":"var"},{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"gr"},"init":{"type":"NewExpression","callee":{"type":"Identifier","name":"GlideAggregate"},"arguments":[{"type":"Literal","value":"sys_user","raw":"\"sys_user\""}]}}],"kind":"var"},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addQuery"}},"arguments":[{"type":"Literal","value":"sys_domain","raw":"\"sys_domain\""},{"type":"Identifier","name":"domainID"}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addNotNullQuery"}},"arguments":[{"type":"Literal","value":"user_name","raw":"\"user_name\""}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addActiveQuery"}},"arguments":[]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"addAggregate"}},"arguments":[{"type":"Literal","value":"COUNT","raw":"\"COUNT\""},{"type":"Literal","value":"user_name","raw":"\"user_name\""}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"groupBy"}},"arguments":[{"type":"Literal","value":"user_name","raw":"\"user_name\""}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"query"}},"arguments":[]}},{"type":"WhileStatement","test":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"next"}},"arguments":[]},"body":{"type":"BlockStatement","body":[{"type":"VariableDeclaration","declarations":[{"type":"VariableDeclarator","id":{"type":"Identifier","name":"count"},"init":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"getAggregate"}},"arguments":[{"type":"Literal","value":"COUNT","raw":"\"COUNT\""},{"type":"Literal","value":"user_name","raw":"\"user_name\""}]}}],"kind":"var"},{"type":"IfStatement","test":{"type":"BinaryExpression","operator":"&gt;","left":{"type":"Identifier","name":"count"},"right":{"type":"Literal","value":1,"raw":"1"}},"consequent":{"type":"BlockStatement","body":[{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userNames"},"property":{"type":"Identifier","name":"push"}},"arguments":[{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gr"},"property":{"type":"Identifier","name":"user_name"}},"property":{"type":"Identifier","name":"toString"}},"arguments":[]}]}},{"type":"IfStatement","test":{"type":"LogicalExpression","operator":"&amp;&amp;","left":{"type":"BinaryExpression","operator":"&gt;","left":{"type":"Identifier","name":"maxUsers"},"right":{"type":"Literal","value":0,"raw":"0"}},"right":{"type":"BinaryExpression","operator":"&gt;=","left":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userNames"},"property":{"type":"Identifier","name":"length"}},"right":{"type":"Identifier","name":"maxUsers"}}},"consequent":{"type":"BlockStatement","body":[{"type":"BreakStatement","label":null}]},"alternate":null}]},"alternate":null}]}},{"type":"ExpressionStatement","expression":{"type":"CallExpression","callee":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"gs"},"property":{"type":"Identifier","name":"info"}},"arguments":[{"type":"BinaryExpression","operator":"+","left":{"type":"Literal","value":"Total duplicate users = ","raw":"\"Total duplicate users = \""},"right":{"type":"MemberExpression","computed":false,"object":{"type":"Identifier","name":"userNames"},"property":{"type":"Identifier","name":"length"}}}]}},{"type":"ReturnStatement","argument":{"type":"Identifier","name":"userNames"}}]},"generator":false,"expression":false,"async":false}]},"generator":false,"expression":false,"async":false},"arguments":[{"type":"Identifier","name":"domainID"}]}}],"sourceType":"script"}</abstract_syntax_tree>
        <added_manually>false</added_manually>
        <api_markdown>## &lt;a name="crc-duplicate-users"&gt;&lt;/a&gt;CRC Duplicate Users
&amp;nbsp;&amp;nbsp;_This is some test code  Line 3_
 
### Type: `Text`
 
### Functions
&lt;br /&gt;
#### `cleanUpUser(userName)`
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Parameters**
 
| Name | Type | Description |
| --- | --- | --- |
| _userName_ | _*_ | _..._ | 
&lt;br /&gt;
#### `getDuplicateUserNames()`
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Returns**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`*`
&lt;br /&gt;
#### `getUserRecords(userName)`
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Parameters**
 
| Name | Type | Description |
| --- | --- | --- |
| _userName_ | _*_ | _..._ | 
 
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Returns**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`*`
&lt;br /&gt;
#### `updateTable(tableDetails)`
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Parameters**
 
| Name | Type | Description |
| --- | --- | --- |
| _tableDetails_ | _*_ | _..._ | 
&lt;br /&gt;
#### `updateTableColumn(columnName)`
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Parameters**
 
| Name | Type | Description |
| --- | --- | --- |
| _columnName_ | _*_ | _..._ | 
 
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Returns**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`*`
 
### Anonymous Functions
&lt;br /&gt;
#### `(domainID)`
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Parameters**
 
| Name | Type | Description |
| --- | --- | --- |
| _domainID_ | _*_ | _..._ | 
 
&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Returns**
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;`*`
</api_markdown>
        <html/>
        <markdown_document/>
        <markdown_link>crc-duplicate-users</markdown_link>
        <order>400</order>
        <project_code_document_version/>
        <remote>false</remote>
        <remote_json/>
        <remote_source_id/>
        <show_html>false</show_html>
        <show_markdown>false</show_markdown>
        <source_description>This is some test code&#13;
&#13;
Line 3</source_description>
        <source_id/>
        <source_key/>
        <source_name>CRC Duplicate Users</source_name>
        <source_script_field/>
        <source_table/>
        <source_text>var domainID = "ff7002960a0a3c810059c36fce436914"; // CRC&#13;
var noUpdate = true;&#13;
var maxUsers = 1000;&#13;
var usersWithUpdates = 0;&#13;
var maxUserUpdates = 1;&#13;
var tablesAndColumns = [&#13;
    {&#13;
        label: "Task",&#13;
        table: "task",&#13;
        columns: [&#13;
            "assigned_to",&#13;
            "opened_by",&#13;
            "closed_by",&#13;
            "u_resolved_by",&#13;
            "watch_list",&#13;
            "u_group_watch_list",&#13;
            "additional_assignee_list"&#13;
        ]&#13;
    },&#13;
    { label: "Incident", table: "incident", columns: ["caller_id"] },&#13;
    { label: "Change Request", table: "change_request", columns: ["requested_by"] },&#13;
    { label: "Facilities Request", table: "facilities", columns: ["caller_id"] },&#13;
    { label: "KB Submission", table: "kb_submission", columns: ["submitted_by"] },&#13;
    { label: "Project", table: "pm_project", columns: ["project_manager", "sponsor"] },&#13;
    { label: "Request", table: "sc_request", columns: ["requested_for"] },&#13;
    {&#13;
        label: "Asset",&#13;
        table: "alm_asset",&#13;
        columns: ["assigned_to", "managed_by", "owned_by", "reserved_for", "supported_by"]&#13;
    },&#13;
    {&#13;
        label: "Configuration Item",&#13;
        table: "cmdb_ci",&#13;
        columns: [&#13;
            "assigned_to",&#13;
            "managed_by",&#13;
            "owned_by",&#13;
            "supported_by",&#13;
            "u_business_manager",&#13;
            "u_technical_manager"&#13;
        ]&#13;
    },&#13;
    { label: "Group Membership", table: "sys_user_grmember", columns: ["user"] }&#13;
];&#13;
&#13;
(function(domainID) {&#13;
    gs.info("CRC Duplicate Users starting @" + gs.nowDateTime());&#13;
    var goodRecordId = null;&#13;
    var duplicateRecordIds = [];&#13;
    var tableName = null;&#13;
    var tableLabel = null;&#13;
    var tableUpdated = false;&#13;
    var userUpdated = false;&#13;
&#13;
    getDuplicateUserNames().forEach(cleanUpUser, this);&#13;
&#13;
    gs.info("Users with rows to update = " + usersWithUpdates);&#13;
&#13;
    gs.info("CRC Duplicate Users ended @" + gs.nowDateTime());&#13;
&#13;
    function cleanUpUser(userName) {&#13;
        // If we only want to update a limited number of users&#13;
        // for testing then skip all records once we've hit the limit&#13;
        if (usersWithUpdates &gt;= maxUserUpdates) {&#13;
            return;&#13;
        }&#13;
&#13;
        duplicateRecordIds = getUserRecords(userName);&#13;
        if (duplicateRecordIds.length &lt;= 1) {&#13;
            gs.warning("No duplicate user records found for user " + userName);&#13;
            return;&#13;
        }&#13;
        goodRecordId = duplicateRecordIds[0];&#13;
        duplicateRecordIds.splice(0, 1);&#13;
&#13;
        gs.info(&#13;
            "User " +&#13;
                userName +&#13;
                " dup records = " +&#13;
                duplicateRecordIds +&#13;
                " good id = " +&#13;
                goodRecordId&#13;
        );&#13;
&#13;
        userUpdated = false;&#13;
&#13;
        tablesAndColumns.forEach(updateTable, this);&#13;
&#13;
        if (userUpdated) {&#13;
            usersWithUpdates++;&#13;
        }&#13;
&#13;
        var userGR = new GlideRecord("sys_user");&#13;
        userGR.addQuery("sys_domain", domainID);&#13;
        userGR.addQuery("sys_id", duplicateRecordIds);&#13;
        userGR.query();&#13;
        userGR.active.setValue(false);&#13;
        userGR.locked_out.setValue(true);&#13;
        gs.info("User " + userName + " query " + userGR.getEncodedQuery());&#13;
        if (!noUpdate) {&#13;
            userGR.updateMultiple();&#13;
        }&#13;
        gs.info(&#13;
            "User " + userName + " had " + duplicateRecordIds.length + " user records inactivated"&#13;
        );&#13;
    }&#13;
&#13;
    function updateTable(tableDetails) {&#13;
        tableName = tableDetails.table;&#13;
        tableName = tableName.trim();&#13;
        tableLabel = tableDetails.label;&#13;
        tableUpdated = false;&#13;
        tableDetails.columns.forEach(updateTableColumn, this);&#13;
        userUpdated = userUpdated || tableUpdated;&#13;
        gs.info("Table " + tableLabel + " [" + tableName + "] updated = " + tableUpdated);&#13;
    }&#13;
&#13;
    function updateTableColumn(columnName) {&#13;
        columnName = columnName.trim();&#13;
        var gr = new GlideRecord(tableName);&#13;
        gr.initialize();&#13;
        gr.addQuery("sys_domain", domainID);&#13;
        if (!gr.isValidField(columnName)) {&#13;
            gs.warning("Invalid column " + columnName + " for table " + tableName);&#13;
        }&#13;
        var fieldType = gr&#13;
            .getElement(columnName)&#13;
            .getED()&#13;
            .getInternalType();&#13;
        if (fieldType == "glide_list") {&#13;
            var q = null;&#13;
            duplicateRecordIds.forEach(function(userID) {&#13;
                if (q) {&#13;
                    q.addOrCondition(columnName, "CONTAINS", userID);&#13;
                } else {&#13;
                    q = gr.addQuery(columnName, "CONTAINS", userID);&#13;
                }&#13;
            }, this);&#13;
        } else if (fieldType == "reference") {&#13;
            gr.addQuery(columnName, duplicateRecordIds);&#13;
        } else {&#13;
            gs.warning(&#13;
                "Unknown field type " +&#13;
                    fieldType +&#13;
                    " for table " +&#13;
                    tableName +&#13;
                    " column " +&#13;
                    columnName&#13;
            );&#13;
            return;&#13;
        }&#13;
        gr.query();&#13;
        if (gr.getRowCount() &gt; 0) {&#13;
            gs.info(&#13;
                "User sys_ids = " +&#13;
                    duplicateRecordIds +&#13;
                    " Rows = " +&#13;
                    gr.getRowCount() +&#13;
                    " Query = " +&#13;
                    gr.getEncodedQuery()&#13;
            );&#13;
            tableUpdated = true;&#13;
        }&#13;
        if (fieldType == "glide_list") {&#13;
            while (gr.next()) {&#13;
                var listValues = gr[columnName].toString().split(",");&#13;
                listValues = listValues.filter(function(entry) {&#13;
                    return duplicateRecordIds.indexOf(entry) &lt; 0;&#13;
                }, this);&#13;
                listValues.push(goodRecordId);&#13;
                gr[columnName].setValue(listValues.join(","));&#13;
                if (!noUpdate) {&#13;
                    gr.update();&#13;
                }&#13;
            }&#13;
        } else if (fieldType == "reference") {&#13;
            gr[columnName].setValue(goodRecordId);&#13;
            if (!noUpdate) {&#13;
                gr.updateMultiple();&#13;
            }&#13;
        }&#13;
    }&#13;
&#13;
    function getUserRecords(userName) {&#13;
        var userRecords = [];&#13;
        var gr = new GlideRecord("sys_user");&#13;
        gr.addQuery("sys_domain", domainID);&#13;
        gr.addQuery("user_name", userName);&#13;
        gr.addActiveQuery();&#13;
        gr.orderBy("sys_created_on");&#13;
        gr.query();&#13;
        while (gr.next()) {&#13;
            userRecords.push(gr.sys_id.toString());&#13;
        }&#13;
        return userRecords;&#13;
    }&#13;
&#13;
    function getDuplicateUserNames() {&#13;
        var userNames = [];&#13;
        var gr = new GlideAggregate("sys_user");&#13;
        gr.addQuery("sys_domain", domainID);&#13;
        gr.addNotNullQuery("user_name");&#13;
        gr.addActiveQuery();&#13;
        gr.addAggregate("COUNT", "user_name");&#13;
        gr.groupBy("user_name");&#13;
        gr.query();&#13;
        while (gr.next()) {&#13;
            var count = gr.getAggregate("COUNT", "user_name");&#13;
            if (count &gt; 1) {&#13;
                userNames.push(gr.user_name.toString());&#13;
                if (maxUsers &gt; 0 &amp;&amp; userNames.length &gt;= maxUsers) {&#13;
                    break;&#13;
                }&#13;
            }&#13;
        }&#13;
        gs.info("Total duplicate users = " + userNames.length);&#13;
        return userNames;&#13;
    }&#13;
})(domainID);&#13;
</source_text>
        <source_type>Text</source_type>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-05-29 21:09:20</sys_created_on>
        <sys_id>0e53a61cdb317300d0cb5385ca9619bc</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-05-29 21:09:20</sys_updated_on>
    </x_58056_md_docs_markdown_source>
</record_update>
]]></payload>
        <sys_class_name>sys_metadata_link</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-12-05 21:32:22</sys_created_on>
        <sys_id>422599d22fe7991448dca1fef699b65a</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>CRC Duplicate Users</sys_name>
        <sys_package display_value="Markdown Documents" source="x_58056_md_docs">7ac0b5344f212300ecf18c318110c745</sys_package>
        <sys_policy/>
        <sys_scope display_value="Markdown Documents">7ac0b5344f212300ecf18c318110c745</sys_scope>
        <sys_update_name>sys_metadata_link_422599d22fe7991448dca1fef699b65a</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2022-12-05 21:32:22</sys_updated_on>
        <tablename>x_58056_md_docs_markdown_source</tablename>
    </sys_metadata_link>
</record_update>
